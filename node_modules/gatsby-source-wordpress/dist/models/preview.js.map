{"version":3,"file":"preview.js","names":["previewStore","state","nodePageCreatedCallbacks","nodeIdsToCreatedPages","pagePathToNodeDependencyId","reducers","unSubscribeToPagesCreatedFromNodeById","nodeId","subscribeToPagesCreatedFromNodeById","sendPreviewStatus","clearPreviewCallbacks","saveNodePageState","page","path"],"sources":["../../src/models/preview.ts"],"sourcesContent":["// `node` here is a Gatsby node\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type OnPageCreatedCallback = (node: any) => Promise<void>\n\nexport interface IStoredPage {\n  path: string\n  updatedAt: number\n}\n\nexport interface IPreviewState {\n  nodePageCreatedCallbacks: {\n    [nodeId: string]: OnPageCreatedCallback\n  }\n  nodeIdsToCreatedPages: {\n    [nodeId: string]: {\n      page: IStoredPage\n    }\n  }\n  pagePathToNodeDependencyId: {\n    [pageId: string]: {\n      nodeId: string\n    }\n  }\n}\n\nexport interface IPreviewReducers {\n  subscribeToPagesCreatedFromNodeById: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n      sendPreviewStatus: OnPageCreatedCallback\n      modified: string\n    }\n  ) => IPreviewState\n  unSubscribeToPagesCreatedFromNodeById: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n    }\n  ) => IPreviewState\n  clearPreviewCallbacks: (state: IPreviewState) => IPreviewState\n  saveNodePageState: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n      page: IStoredPage\n    }\n  ) => IPreviewState\n}\n\nexport interface IPreviewStore {\n  state: IPreviewState\n  reducers: IPreviewReducers\n}\n\nconst previewStore: IPreviewStore = {\n  state: {\n    nodePageCreatedCallbacks: {},\n    nodeIdsToCreatedPages: {},\n    pagePathToNodeDependencyId: {},\n  },\n\n  reducers: {\n    unSubscribeToPagesCreatedFromNodeById(state, { nodeId }) {\n      if (state.nodePageCreatedCallbacks?.[nodeId]) {\n        delete state.nodePageCreatedCallbacks[nodeId]\n      }\n\n      return state\n    },\n\n    subscribeToPagesCreatedFromNodeById(state, { nodeId, sendPreviewStatus }) {\n      // save the callback for this nodeId\n      // when a page is created from a node that has this id,\n      // the callback will be invoked\n      state.nodePageCreatedCallbacks[nodeId] = sendPreviewStatus\n\n      return state\n    },\n\n    clearPreviewCallbacks(state) {\n      state.nodePageCreatedCallbacks = {}\n\n      return state\n    },\n\n    saveNodePageState(state, { page, nodeId }) {\n      state.nodeIdsToCreatedPages[nodeId] = {\n        page,\n      }\n\n      state.pagePathToNodeDependencyId[page.path] = {\n        nodeId,\n      }\n\n      return state\n    },\n  } as IPreviewReducers,\n}\n\nexport default previewStore\n"],"mappings":";;;;AAAA;AACA;;AAsDA,MAAMA,YAA2B,GAAG;EAClCC,KAAK,EAAE;IACLC,wBAAwB,EAAE,CAAC,CAAC;IAC5BC,qBAAqB,EAAE,CAAC,CAAC;IACzBC,0BAA0B,EAAE,CAAC;EAC/B,CAAC;EAEDC,QAAQ,EAAE;IACRC,qCAAqC,CAACL,KAAK,EAAE;MAAEM;IAAO,CAAC,EAAE;MAAA;MACvD,6BAAIN,KAAK,CAACC,wBAAwB,kDAA9B,sBAAiCK,MAAM,CAAC,EAAE;QAC5C,OAAON,KAAK,CAACC,wBAAwB,CAACK,MAAM,CAAC;MAC/C;MAEA,OAAON,KAAK;IACd,CAAC;IAEDO,mCAAmC,CAACP,KAAK,EAAE;MAAEM,MAAM;MAAEE;IAAkB,CAAC,EAAE;MACxE;MACA;MACA;MACAR,KAAK,CAACC,wBAAwB,CAACK,MAAM,CAAC,GAAGE,iBAAiB;MAE1D,OAAOR,KAAK;IACd,CAAC;IAEDS,qBAAqB,CAACT,KAAK,EAAE;MAC3BA,KAAK,CAACC,wBAAwB,GAAG,CAAC,CAAC;MAEnC,OAAOD,KAAK;IACd,CAAC;IAEDU,iBAAiB,CAACV,KAAK,EAAE;MAAEW,IAAI;MAAEL;IAAO,CAAC,EAAE;MACzCN,KAAK,CAACE,qBAAqB,CAACI,MAAM,CAAC,GAAG;QACpCK;MACF,CAAC;MAEDX,KAAK,CAACG,0BAA0B,CAACQ,IAAI,CAACC,IAAI,CAAC,GAAG;QAC5CN;MACF,CAAC;MAED,OAAON,KAAK;IACd;EACF;AACF,CAAC;AAAA,eAEcD,YAAY;AAAA"}