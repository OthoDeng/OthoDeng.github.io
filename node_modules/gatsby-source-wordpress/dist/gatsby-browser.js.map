{"version":3,"file":"gatsby-browser.js","names":["React","ReactDOM","hydrateRef","onRouteUpdate","window","cancelIdleCallback","requestIdleCallback","hydrateImages","clearTimeout","setTimeout","doc","document","inlineWPimages","Array","from","querySelectorAll","length","then","mod","forEach","image","grandParentIsGatsbyImage","parentNode","classList","contains","parentIsGatsbyImage","gatsbyImageHydrationElement","dataset","wpInlineImage","hydrationData","querySelector","imageProps","JSON","parse","innerHTML","root","createRoot","render","createElement","GatsbyImage"],"sources":["../src/gatsby-browser.ts"],"sourcesContent":["import type { GatsbyImageProps } from \"gatsby-plugin-image\"\nimport React from \"react\"\nimport ReactDOM from \"react-dom/client\"\n\nlet hydrateRef\n\nexport function onRouteUpdate(): void {\n  if (`requestIdleCallback` in window) {\n    if (hydrateRef) {\n      // @ts-ignore cancelIdleCallback is on window object\n      cancelIdleCallback(hydrateRef)\n    }\n\n    // @ts-ignore requestIdleCallback is on window object\n    hydrateRef = requestIdleCallback(hydrateImages)\n  } else {\n    if (hydrateRef) {\n      clearTimeout(hydrateRef)\n    }\n    hydrateRef = setTimeout(hydrateImages)\n  }\n}\n\nfunction hydrateImages(): void {\n  const doc = document\n  const inlineWPimages: Array<HTMLElement> = Array.from(\n    doc.querySelectorAll(`[data-wp-inline-image]`)\n  )\n\n  if (!inlineWPimages.length) {\n    return\n  }\n\n  import(\n    /* webpackChunkName: \"gatsby-plugin-image\" */ `gatsby-plugin-image`\n  ).then(mod => {\n    inlineWPimages.forEach(image => {\n      // usually this is the right element to hydrate on\n      const grandParentIsGatsbyImage =\n        // @ts-ignore-next-line classList is on HTMLElement\n        image?.parentNode?.parentNode?.classList?.contains(\n          `gatsby-image-wrapper`\n        )\n\n      // but sometimes this is the right element\n      const parentIsGatsbyImage =\n        // @ts-ignore-next-line classList is on HTMLElement\n        image?.parentNode?.classList?.contains(`gatsby-image-wrapper`)\n\n      if (!grandParentIsGatsbyImage && !parentIsGatsbyImage) {\n        return\n      }\n\n      const gatsbyImageHydrationElement = grandParentIsGatsbyImage\n        ? image.parentNode.parentNode\n        : image.parentNode\n\n      if (\n        image.dataset &&\n        image.dataset.wpInlineImage &&\n        gatsbyImageHydrationElement\n      ) {\n        const hydrationData = doc.querySelector(\n          `script[data-wp-inline-image-hydration=\"${image.dataset.wpInlineImage}\"]`\n        )\n\n        if (hydrationData) {\n          const imageProps: GatsbyImageProps = JSON.parse(\n            hydrationData.innerHTML\n          )\n\n          // @ts-ignore - TODO: Fix me\n          const root = ReactDOM.createRoot(gatsbyImageHydrationElement)\n          root.render(React.createElement(mod.GatsbyImage, imageProps))\n        }\n      }\n    })\n  })\n}\n"],"mappings":"AACA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,QAAQ,MAAM,kBAAkB;AAEvC,IAAIC,UAAU;AAEd,OAAO,SAASC,aAAa,GAAS;EACpC,IAAK,qBAAoB,IAAIC,MAAM,EAAE;IACnC,IAAIF,UAAU,EAAE;MACd;MACAG,kBAAkB,CAACH,UAAU,CAAC;IAChC;;IAEA;IACAA,UAAU,GAAGI,mBAAmB,CAACC,aAAa,CAAC;EACjD,CAAC,MAAM;IACL,IAAIL,UAAU,EAAE;MACdM,YAAY,CAACN,UAAU,CAAC;IAC1B;IACAA,UAAU,GAAGO,UAAU,CAACF,aAAa,CAAC;EACxC;AACF;AAEA,SAASA,aAAa,GAAS;EAC7B,MAAMG,GAAG,GAAGC,QAAQ;EACpB,MAAMC,cAAkC,GAAGC,KAAK,CAACC,IAAI,CACnDJ,GAAG,CAACK,gBAAgB,CAAE,wBAAuB,CAAC,CAC/C;EAED,IAAI,CAACH,cAAc,CAACI,MAAM,EAAE;IAC1B;EACF;EAEA,MAAM,EACJ,6CAA+C,qBAAoB,CACpE,CAACC,IAAI,CAACC,GAAG,IAAI;IACZN,cAAc,CAACO,OAAO,CAACC,KAAK,IAAI;MAAA;MAC9B;MACA,MAAMC,wBAAwB,GAC5B;MACAD,KAAK,aAALA,KAAK,4CAALA,KAAK,CAAEE,UAAU,+EAAjB,kBAAmBA,UAAU,oFAA7B,sBAA+BC,SAAS,2DAAxC,uBAA0CC,QAAQ,CAC/C,sBAAqB,CACvB;;MAEH;MACA,MAAMC,mBAAmB,GACvB;MACAL,KAAK,aAALA,KAAK,6CAALA,KAAK,CAAEE,UAAU,gFAAjB,mBAAmBC,SAAS,0DAA5B,sBAA8BC,QAAQ,CAAE,sBAAqB,CAAC;MAEhE,IAAI,CAACH,wBAAwB,IAAI,CAACI,mBAAmB,EAAE;QACrD;MACF;MAEA,MAAMC,2BAA2B,GAAGL,wBAAwB,GACxDD,KAAK,CAACE,UAAU,CAACA,UAAU,GAC3BF,KAAK,CAACE,UAAU;MAEpB,IACEF,KAAK,CAACO,OAAO,IACbP,KAAK,CAACO,OAAO,CAACC,aAAa,IAC3BF,2BAA2B,EAC3B;QACA,MAAMG,aAAa,GAAGnB,GAAG,CAACoB,aAAa,CACpC,0CAAyCV,KAAK,CAACO,OAAO,CAACC,aAAc,IAAG,CAC1E;QAED,IAAIC,aAAa,EAAE;UACjB,MAAME,UAA4B,GAAGC,IAAI,CAACC,KAAK,CAC7CJ,aAAa,CAACK,SAAS,CACxB;;UAED;UACA,MAAMC,IAAI,GAAGlC,QAAQ,CAACmC,UAAU,CAACV,2BAA2B,CAAC;UAC7DS,IAAI,CAACE,MAAM,eAACrC,KAAK,CAACsC,aAAa,CAACpB,GAAG,CAACqB,WAAW,EAAER,UAAU,CAAC,CAAC;QAC/D;MACF;IACF,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ"}