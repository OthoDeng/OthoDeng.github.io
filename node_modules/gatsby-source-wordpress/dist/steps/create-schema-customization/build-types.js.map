{"version":3,"file":"build-types.js","names":["unionType","typeBuilderApi","schema","type","pluginOptions","types","possibleTypes","filter","possibleType","typeIsExcluded","typeName","name","map","buildTypeName","length","resolveType","node","__typename","extensions","infer","filterTypeDefinition","buildUnionType","interfaceType","state","store","getState","ingestibles","remoteSchema","nodeInterfaceTypes","implementingTypes","getTypesThatImplementInterfaceType","transformedFields","transformFields","parentInterfacesImplementingTypes","parentType","fields","typeDef","includes","buildInterfaceType","objectType","gatsbyNodeTypes","fieldAliases","fieldBlacklist","Object","keys","description","interfaces","buildObjectType","enumType","buildEnumType","values","enumValues","reduce","accumulator"],"sources":["../../../src/steps/create-schema-customization/build-types.js"],"sourcesContent":["import store from \"~/store\"\nimport { transformFields } from \"./transform-fields\"\nimport { typeIsExcluded } from \"~/steps/ingest-remote-schema/is-excluded\"\nimport {\n  buildTypeName,\n  filterTypeDefinition,\n  getTypesThatImplementInterfaceType,\n} from \"./helpers\"\n\nconst unionType = typeBuilderApi => {\n  const { schema, type, pluginOptions } = typeBuilderApi\n\n  const types = type.possibleTypes\n    .filter(\n      possibleType =>\n        !typeIsExcluded({\n          pluginOptions,\n          typeName: possibleType.name,\n        })\n    )\n    .map(possibleType => buildTypeName(possibleType.name))\n\n  if (!types || !types.length) {\n    return false\n  }\n\n  let unionType = {\n    name: buildTypeName(type.name),\n    types,\n    resolveType: node => {\n      if (node.__typename) {\n        return buildTypeName(node.__typename)\n      }\n\n      return null\n    },\n    extensions: {\n      infer: false,\n    },\n  }\n\n  // @todo add this as a plugin option\n  unionType = filterTypeDefinition(unionType, typeBuilderApi, `UNION`)\n\n  return schema.buildUnionType(unionType)\n}\n\nconst interfaceType = typeBuilderApi => {\n  const { type, schema } = typeBuilderApi\n\n  const state = store.getState()\n  const { ingestibles } = state.remoteSchema\n  const { nodeInterfaceTypes } = ingestibles\n\n  const implementingTypes = getTypesThatImplementInterfaceType(type)\n\n  const transformedFields = transformFields({\n    parentInterfacesImplementingTypes: implementingTypes,\n    parentType: type,\n    fields: type.fields,\n  })\n\n  if (!transformedFields) {\n    return null\n  }\n\n  let typeDef = {\n    name: buildTypeName(type.name),\n    fields: transformedFields,\n    extensions: { infer: false },\n  }\n\n  // this is a regular interface type, not a node interface type so we need to resolve the type name\n  if (!nodeInterfaceTypes.includes(type.name)) {\n    typeDef.resolveType = node =>\n      node?.__typename ? buildTypeName(node.__typename) : null\n  }\n\n  typeDef = filterTypeDefinition(typeDef, typeBuilderApi, `INTERFACE`)\n\n  return schema.buildInterfaceType(typeDef)\n}\n\nconst objectType = typeBuilderApi => {\n  const { type, gatsbyNodeTypes, fieldAliases, fieldBlacklist, schema } =\n    typeBuilderApi\n\n  const transformedFields = transformFields({\n    fields: type.fields,\n    parentType: type,\n    gatsbyNodeTypes,\n    fieldAliases,\n    fieldBlacklist,\n  })\n\n  // if all child fields are excluded, this type shouldn't exist.\n  // check null first, otherwise cause:\n  // TypeError: Cannot convert undefined or null to object at Function.keys (<anonymous>)\n  // Also cause wordpress blog site build failure in createSchemaCustomization step\n  if (!transformedFields || !Object.keys(transformedFields).length) {\n    return false\n  }\n\n  let objectType = {\n    name: buildTypeName(type.name),\n    fields: transformedFields,\n    description: type.description,\n    extensions: {\n      infer: false,\n    },\n  }\n\n  if (type.interfaces?.includes(`Node`)) {\n    objectType.interfaces = [`Node`]\n  }\n\n  // @todo add this as a plugin option\n  objectType = filterTypeDefinition(objectType, typeBuilderApi, `OBJECT`)\n\n  return schema.buildObjectType(objectType)\n}\n\nconst enumType = ({ schema, type }) =>\n  schema.buildEnumType({\n    name: buildTypeName(type.name),\n    values: type.enumValues.reduce((accumulator, { name }) => {\n      accumulator[name] = { name }\n\n      return accumulator\n    }, {}),\n    description: type.description,\n  })\n\nexport default { unionType, interfaceType, objectType, enumType }\n"],"mappings":"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"}