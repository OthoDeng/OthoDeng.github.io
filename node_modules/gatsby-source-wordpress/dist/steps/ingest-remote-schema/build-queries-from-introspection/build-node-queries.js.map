{"version":3,"file":"build-node-queries.js","names":["buildNodeQueries","pluginOptions","getGatsbyApi","QUERY_CACHE_KEY","url","nodeQueries","getPersistentCache","key","schemaWasChanged","store","getState","remoteSchema","generateNodeQueriesFromIngestibleFields","setPersistentCache","value","dispatch","setState"],"sources":["../../../../src/steps/ingest-remote-schema/build-queries-from-introspection/build-node-queries.js"],"sourcesContent":["import store from \"~/store\"\nimport { getGatsbyApi } from \"~/utils/get-gatsby-api\"\nimport generateNodeQueriesFromIngestibleFields from \"./generate-queries-from-ingestable-types\"\nimport { getPersistentCache, setPersistentCache } from \"~/utils/cache\"\n\n/**\n * buildNodeQueries\n *\n * Uses plugin options to introspect the remote GraphQL\n * source, run cache logic, and generate GQL query strings/info\n *\n * @returns {Object} GraphQL query info including gql query strings\n */\nconst buildNodeQueries = async () => {\n  const { pluginOptions } = getGatsbyApi()\n\n  const QUERY_CACHE_KEY = `${pluginOptions.url}--introspection-node-queries`\n\n  let nodeQueries = await getPersistentCache({ key: QUERY_CACHE_KEY })\n\n  const { schemaWasChanged } = store.getState().remoteSchema\n\n  if (schemaWasChanged || !nodeQueries) {\n    // regenerate queries from introspection\n    nodeQueries = await generateNodeQueriesFromIngestibleFields()\n\n    // and cache them\n    await setPersistentCache({ key: QUERY_CACHE_KEY, value: nodeQueries })\n  }\n  // set the queries in our redux store to use later\n  store.dispatch.remoteSchema.setState({\n    nodeQueries,\n  })\n\n  return nodeQueries\n}\n\nexport { buildNodeQueries }\n"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMA,gBAAgB,GAAG,YAAY;EACnC,MAAM;IAAEC;EAAc,CAAC,GAAG,IAAAC,0BAAY,GAAE;EAExC,MAAMC,eAAe,GAAI,GAAEF,aAAa,CAACG,GAAI,8BAA6B;EAE1E,IAAIC,WAAW,GAAG,MAAM,IAAAC,yBAAkB,EAAC;IAAEC,GAAG,EAAEJ;EAAgB,CAAC,CAAC;EAEpE,MAAM;IAAEK;EAAiB,CAAC,GAAGC,cAAK,CAACC,QAAQ,EAAE,CAACC,YAAY;EAE1D,IAAIH,gBAAgB,IAAI,CAACH,WAAW,EAAE;IACpC;IACAA,WAAW,GAAG,MAAM,IAAAO,2CAAuC,GAAE;;IAE7D;IACA,MAAM,IAAAC,yBAAkB,EAAC;MAAEN,GAAG,EAAEJ,eAAe;MAAEW,KAAK,EAAET;IAAY,CAAC,CAAC;EACxE;EACA;EACAI,cAAK,CAACM,QAAQ,CAACJ,YAAY,CAACK,QAAQ,CAAC;IACnCX;EACF,CAAC,CAAC;EAEF,OAAOA,WAAW;AACpB,CAAC;AAAA"}