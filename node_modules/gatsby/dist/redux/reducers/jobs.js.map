{"version":3,"file":"jobs.js","names":["jobsReducer","state","active","done","action","type","payload","id","Error","index","_","findIndex","j","mergedJob","merge","createdAt","Date","now","plugin","push","completedAt","oneLine","get","job","splice","runTime","moment","diff"],"sources":["../../../src/redux/reducers/jobs.ts"],"sourcesContent":["import _ from \"lodash\"\nimport { oneLine } from \"common-tags\"\nimport moment from \"moment\"\n\nimport { IGatsbyState, ActionsUnion } from \"../types\"\n\nexport const jobsReducer = (\n  state: IGatsbyState[\"jobs\"] = { active: [], done: [] },\n  action: ActionsUnion\n): IGatsbyState[\"jobs\"] => {\n  switch (action.type) {\n    case `CREATE_JOB`:\n    case `SET_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when creating or setting job`)\n      }\n      const index = _.findIndex(state.active, j => j.id === action.payload.id)\n      if (index !== -1) {\n        const mergedJob = _.merge(state.active[index], {\n          ...action.payload,\n          createdAt: Date.now(),\n          plugin: action.plugin,\n        })\n\n        state.active[index] = mergedJob\n        return state\n      } else {\n        state.active.push({\n          ...action.payload,\n          createdAt: Date.now(),\n          plugin: action.plugin,\n        })\n        return state\n      }\n    }\n    case `END_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when ending a job`)\n      }\n      const completedAt = Date.now()\n      const index = _.findIndex(state.active, j => j.id === action.payload.id)\n      if (index === -1) {\n        throw new Error(oneLine`\n          The plugin \"${_.get(action, `plugin.name`, `anonymous`)}\"\n          tried to end a job with the id \"${action.payload.id}\"\n          that either hasn't yet been created or has already been ended`)\n      }\n      const job = state.active.splice(index, 1)[0]\n      state.done.push({\n        ...job,\n        completedAt,\n        runTime: moment(completedAt).diff(moment(job.createdAt)),\n      })\n\n      return state\n    }\n  }\n\n  return state\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAIO,MAAMA,WAAW,GAAG,CACzBC,KAA2B,GAAG;EAAEC,MAAM,EAAE,EAAV;EAAcC,IAAI,EAAE;AAApB,CADL,EAEzBC,MAFyB,KAGA;EACzB,QAAQA,MAAM,CAACC,IAAf;IACE,KAAM,YAAN;IACA,KAAM,SAAN;MAAgB;QACd,IAAI,CAACD,MAAM,CAACE,OAAP,CAAeC,EAApB,EAAwB;UACtB,MAAM,IAAIC,KAAJ,CAAW,qDAAX,CAAN;QACD;;QACD,MAAMC,KAAK,GAAGC,eAAA,CAAEC,SAAF,CAAYV,KAAK,CAACC,MAAlB,EAA0BU,CAAC,IAAIA,CAAC,CAACL,EAAF,KAASH,MAAM,CAACE,OAAP,CAAeC,EAAvD,CAAd;;QACA,IAAIE,KAAK,KAAK,CAAC,CAAf,EAAkB;UAChB,MAAMI,SAAS,GAAGH,eAAA,CAAEI,KAAF,CAAQb,KAAK,CAACC,MAAN,CAAaO,KAAb,CAAR,EAA6B,EAC7C,GAAGL,MAAM,CAACE,OADmC;YAE7CS,SAAS,EAAEC,IAAI,CAACC,GAAL,EAFkC;YAG7CC,MAAM,EAAEd,MAAM,CAACc;UAH8B,CAA7B,CAAlB;;UAMAjB,KAAK,CAACC,MAAN,CAAaO,KAAb,IAAsBI,SAAtB;UACA,OAAOZ,KAAP;QACD,CATD,MASO;UACLA,KAAK,CAACC,MAAN,CAAaiB,IAAb,CAAkB,EAChB,GAAGf,MAAM,CAACE,OADM;YAEhBS,SAAS,EAAEC,IAAI,CAACC,GAAL,EAFK;YAGhBC,MAAM,EAAEd,MAAM,CAACc;UAHC,CAAlB;UAKA,OAAOjB,KAAP;QACD;MACF;;IACD,KAAM,SAAN;MAAgB;QACd,IAAI,CAACG,MAAM,CAACE,OAAP,CAAeC,EAApB,EAAwB;UACtB,MAAM,IAAIC,KAAJ,CAAW,0CAAX,CAAN;QACD;;QACD,MAAMY,WAAW,GAAGJ,IAAI,CAACC,GAAL,EAApB;;QACA,MAAMR,KAAK,GAAGC,eAAA,CAAEC,SAAF,CAAYV,KAAK,CAACC,MAAlB,EAA0BU,CAAC,IAAIA,CAAC,CAACL,EAAF,KAASH,MAAM,CAACE,OAAP,CAAeC,EAAvD,CAAd;;QACA,IAAIE,KAAK,KAAK,CAAC,CAAf,EAAkB;UAChB,MAAM,IAAID,KAAJ,CAAU,IAAAa,mBAAA,CAAQ;AAChC,wBAAwBX,eAAA,CAAEY,GAAF,CAAMlB,MAAN,EAAe,aAAf,EAA8B,WAA9B,CAA0C;AAClE,4CAA4CA,MAAM,CAACE,OAAP,CAAeC,EAAG;AAC9D,wEAHc,CAAN;QAID;;QACD,MAAMgB,GAAG,GAAGtB,KAAK,CAACC,MAAN,CAAasB,MAAb,CAAoBf,KAApB,EAA2B,CAA3B,EAA8B,CAA9B,CAAZ;QACAR,KAAK,CAACE,IAAN,CAAWgB,IAAX,CAAgB,EACd,GAAGI,GADW;UAEdH,WAFc;UAGdK,OAAO,EAAE,IAAAC,eAAA,EAAON,WAAP,EAAoBO,IAApB,CAAyB,IAAAD,eAAA,EAAOH,GAAG,CAACR,SAAX,CAAzB;QAHK,CAAhB;QAMA,OAAOd,KAAP;MACD;EA7CH;;EAgDA,OAAOA,KAAP;AACD,CArDM"}