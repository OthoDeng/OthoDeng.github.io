{"version":3,"file":"components.js","names":["programStatus","componentsReducer","state","Map","action","type","component","get","payload","componentPath","componentChunkName","query","pages","Set","isInBootstrap","serverData","config","isSlice","add","name","set","path","normalize","delete"],"sources":["../../../src/redux/reducers/components.ts"],"sourcesContent":["import normalize from \"../../utils/normalize-path\"\nimport { IGatsbyState, ActionsUnion } from \"../types\"\n\nlet programStatus = `BOOTSTRAPPING`\n\n// TODO: replace usages of this reducer with queries.trackedComponents\n//  It is here merely for compatibility.\nexport const componentsReducer = (\n  state: IGatsbyState[\"components\"] = new Map(),\n  action: ActionsUnion\n): IGatsbyState[\"components\"] => {\n  switch (action.type) {\n    case `CREATE_SLICE`: {\n      let component = state.get(action.payload.componentPath)\n      if (!component) {\n        component = {\n          componentPath: action.payload.componentPath,\n          componentChunkName: action.payload.componentChunkName,\n          query: ``,\n          pages: new Set(),\n          isInBootstrap: true,\n          serverData: false,\n          config: false,\n          isSlice: true,\n        }\n      }\n      component.pages.add(action.payload.name)\n      component.isInBootstrap = programStatus === `BOOTSTRAPPING`\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `DELETE_CACHE`:\n      return new Map()\n    case `SET_PROGRAM_STATUS`:\n      programStatus = action.payload\n      return state\n    case `CREATE_PAGE`: {\n      // Create XState service.\n      let component = state.get(action.payload.componentPath)\n      if (!component) {\n        component = {\n          componentPath: action.payload.componentPath,\n          componentChunkName: action.payload.componentChunkName,\n          query: ``,\n          pages: new Set(),\n          isInBootstrap: true,\n          serverData: false,\n          config: false,\n          isSlice: false,\n        }\n      }\n      component.pages.add(action.payload.path)\n      component.isInBootstrap = programStatus === `BOOTSTRAPPING`\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `QUERY_EXTRACTED`: {\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      const component = state.get(action.payload.componentPath)!\n      component.query = action.payload.query\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `REMOVE_STATIC_QUERIES_BY_TEMPLATE`: {\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      state.delete(action.payload.componentPath)\n      return state\n    }\n    case `SET_COMPONENT_FEATURES`: {\n      const path = normalize(action.payload.componentPath)\n      const component = state.get(path)\n      if (component) {\n        component.serverData = action.payload.serverData\n        component.config = action.payload.config\n      }\n      return state\n    }\n    case `DELETE_PAGE`: {\n      const component = state.get(normalize(action.payload.component))!\n      component.pages.delete(action.payload.path)\n      return state\n    }\n    case `DELETE_SLICE`: {\n      const component = state.get(normalize(action.payload.componentPath))\n      if (component) {\n        component.pages.delete(action.payload.name)\n      }\n      return state\n    }\n  }\n\n  return state\n}\n"],"mappings":"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"}